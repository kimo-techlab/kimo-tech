<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ | KIMO TECH</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background:#f8fafc;
}

.checkout-container{
  max-width:700px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}

h1{
  text-align:center;
  margin-bottom:30px;
}

.order-summary{
  background:#f1f5f9;
  padding:15px;
  border-radius:12px;
  margin-bottom:25px;
}

.order-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}

.total{
  font-weight:900;
  font-size:18px;
  margin-top:10px;
  color:#22c55e;
}

input, select{
  width:100%;
  padding:12px;
  margin-bottom:15px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#0ea5e9;
  color:#fff;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
}

button:hover{
  background:#0284c7;
}

.payment-box{
  background:#f1f5f9;
  padding:12px;
  border-radius:12px;
  margin-bottom:15px;
  display:none;
}
</style>
</head>

<body>

<div class="checkout-container">
  <h1>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ğŸ§¾</h1>

  <div class="order-summary" id="orderSummary"></div>

  <input type="text" id="customerName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
  <input type="tel" id="customerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
  <input type="text" id="customerAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">

  <select id="paymentMethod" onchange="handlePaymentChange()">
    <option value="cash">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
    <option value="vodafone">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
    <option value="instapay">InstaPay</option>
  </select>

  <div class="payment-box" id="instaBox">
    ğŸ“Œ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù„Ù‰:<br>
    ğŸ’³ InstaPay: 01555735099<br>
    ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: KIMO TECH<br>
    Ø«Ù… Ø§Ø¶ØºØ· ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
  </div>

  <button onclick="submitOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
</div>

<!-- Firebase -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA2ff2ZaA-Xb_zQcVSUDaERS-glaFFR0TY",
  authDomain: "kimo-tech-store-962df.firebaseapp.com",
  projectId: "kimo-tech-store-962df",
  storageBucket: "kimo-tech-store-962df.firebasestorage.app",
  messagingSenderId: "845478890277",
  appId: "1:845478890277:web:3cdd3328bde1b5b9dda8cc"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===== */

let cart = JSON.parse(localStorage.getItem("cart")) || [];
const summary = document.getElementById("orderSummary");
let total = 0;

cart.forEach(p=>{
  total += p.price;

  summary.innerHTML += `
    <div class="order-item">
      <span>${p.name}</span>
      <span>${p.price} EGP</span>
    </div>
  `;
});

summary.innerHTML += `<div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} EGP</div>`;

/* ===== Ø§Ø¸Ù‡Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª InstaPay ===== */

window.handlePaymentChange = function(){
  const payment = document.getElementById("paymentMethod").value;
  const box = document.getElementById("instaBox");

  if(payment === "instapay"){
    box.style.display = "block";
  }else{
    box.style.display = "none";
  }
}

/* ===== Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ===== */

window.submitOrder = async function(){

  const name = document.getElementById("customerName").value;
  const phone = document.getElementById("customerPhone").value;
  const address = document.getElementById("customerAddress").value;
  const payment = document.getElementById("paymentMethod").value;

  if(!name || !phone || !address){
    alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
    return;
  }

  try{

    await addDoc(collection(db, "orders"), {
      customerName: name,
      phone: phone,
      address: address,
      paymentMethod: payment,
      items: cart,
      total: total,
      createdAt: new Date()
    });

    alert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰");

    localStorage.removeItem("cart");
    window.location.href = "index.html";

  }catch(error){
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨");
    console.error(error);
  }

}

</script>

</body>
</html>
